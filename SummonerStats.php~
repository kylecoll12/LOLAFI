<!DOCTYPE html>
<html>
<head>
   <meta name="author" content="Kyle Collins">
   <meta name="description" content="Grabs Selected Summoner Information">
   <title>League of Legends Info</title>
   <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0">
   <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.2.min.js"></script>
        <!--jQuery, linked from a CDN-->
   <!--<script src="scripts.js"></script>-->
	
   <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="container">
<style>
	body {
		font-family: Helvetica;	
	}
	
	.ranktable {
		border-collapse: collapse;
		background-color: #FFFFFF;
		color: #000000;
		height: 100%;
	}
	
	.ranktableheader {
		font-weight: bold;
		color: white;
		background-color: gray;
	}
	
	.ranktable tr {
		border: solid 1px #000000
	}
	
	.ranktable td {
		padding: 7px;	
		border-left: 0;
		border-right: 0;
	}
	
	.iconcell
	{
	background-size: 42px;
background-position: center;
width: 32px;
height: 32px;
display: inline-block;
vertical-align: middle;
border-radius: 3px;
box-shadow: 0 0 2px #000;
-webkit-box-shadow: 0 0 2px #000;
	}
</style>

<script type="text/javascript">
		function showDiv(id) {
			var jqueryname="#" + id;
			//if you use "block" on a <tr> then you will only occupy one column so we use "table-row" instead
			if($(jqueryname).css("display")=="table-row")
				$(jqueryname).css("display", "none");
			else
				$(jqueryname).css("display", "table-row");
		};
</script>

<?php
	ini_set('display_errors', 'On');
	error_reporting(E_ALL);
	date_default_timezone_set('America/Chicago');
	$summonerInfo=array();
	$games=array();
	$gamesparent=array();
	$xml=simplexml_load_file("SummonerInfo.xml");
	$summonerSpace=$_GET['summoner'];
	$summoner=str_replace(' ', '', $summonerSpace);
        //look up summoner info
	$node=$xml->xpath('//summoner[name[.="'.$summonerSpace.'"]]');  //search by name
	//var_dump($node[0]);
	$summonerInfo['name']= $node[0]->name;
	$summonerInfo['id']= $node[0]->id;
	$summonerInfo['summonerLevel']= $node[0]->summonerLevel;
	$summonerInfo['profileIconId']= $node[0]->profileIconId;
	$summonerInfo['league']=$node[0]->league;
	$summonerInfo['rank']=$node[0]->rank;
	$summonerInfo['leaguePoints']=$node[0]->leaguePoints;
	
	$gamesparent=$node[0]->games->game;
    
	
	//var_dump(count($results));
    //sort
	function formatStat($sName,$s)
	{
		if(substr($sName,0,4)=="item")
			return lookupItem($s);
		else
			return $s;
	}
	function lookupItem($itemId)
	{
		$xmlItems=simplexml_load_file("ItemData.xml");
		$node=$xmlItems->xpath('//item[@id="'.$itemId.'"]');
		return $node[0]["name"];
	}
	function lookupChampion($champId)
	{
		$xmlChamps=simplexml_load_file("ChampionData.xml");
		$node=$xmlChamps->xpath('//champion[@id="'.$champId.'"]');
		return $node[0]["name"];
	}
	
	function getLeagueValue($a)
    {
    	if($a=="BRONZE")
    		return 5;
    	else if($a=="SILVER")
    		return 4;
    	else if($a=="GOLD")
    		return 3;
    	else if($a=="PLATINUM")
    		return 2;
    	else if($a=="DIAMOND")
    		return 1;
    	else if($a=="CHALLENGER")
    		return 0;
    	else
    		return 6;
    }
    
    function getWLColor($a)
    {
    	    if($a=="1")
    	    	    return "#99FF99";
    	    else
    	    	    return "#FF9999";
    }
    
    function getRank($a)
    {
    	if($a=="V")
    		return 5;
    	else if($a=="IV")
    		return 4;
    	else if($a=="III")
    		return 3;
    	else if($a=="II")
    		return 2;
    	else if($a=="I")
    		return 1;
    	else
    		return 6;
    }
    function cmp($a,$b)  //compares summoner a and b to find the higher ranked.  if a<b returns <0 if a>b returns >0 0 if they are equal
    {
    	if(getLeagueValue($a["league"])==getLeagueValue($b["league"])) {
    			if(getRank($a["rank"])==getRank($b["rank"])) {
    					return ($a["leaguePoints"] < $b["leaguePoints"]) ? -1 : 1;
    			}
    			else
    				return (getRank($a["rank"]) < getRank($b["rank"])) ? -1 : 1;
    	}
    	else
    		return (getLeagueValue($a["league"]) < getLeagueValue($b["league"])) ? -1 : 1;
    	//return strcmp($a["league"],$b["league"]);
    }
    function timecmp($a,$b)
    { 
    	    //echo "<br><br>".$a->createDate;
    	    //echo "<br>".$b->createDate;
    	    //echo "<br><br>";
    	    return strcmp($b->createDate,$a->createDate);
    	    //return ((int)$b->createDate) - ((int)$a->createDate);
    }
	
	foreach($gamesparent as $game) {$games[] = $game;}
	
    uasort($games,"timecmp");
    //usort($results,"cmp");
    //var_dump($node[0]->games);
    //var_dump($games[2]);
    //date('Y-m-d H:i:s', (int)substr($game->createDate,0,-3));  gets date and time
?>
<center>
<table class='ranktable' border='1'>
<tr class='ranktableheader'>
	<td colspan='5'>Stats</td>
</tr>
<tr class='ranktableheader'><td>Mode</td><td>Champion</td><td>K/D/A</td><td>Date</td><td></td></tr>
<?php foreach ($games as $game): ?>
<?php echo "<tr style='background-color: ".getWLColor($game->stats->win).";'>" ?>
<td><?php echo $game->subType ?></td>
<td><?php echo lookupChampion($game->championId); ?></td>
<td><?php echo $game->stats->championsKilled."/".$game->stats->numDeaths."/".$game->stats->assists ?></td>
<td><?php echo date('m/d/Y', (int)substr($game->createDate,0,-3)); ?></td>
<?php echo "<td style='background-color: gray; color: white; cursor: pointer; font-size: small;' onclick=\"showDiv('g".$game->gameId."')\">+</td>" ?>
</tr>
<?php echo "<tr style='display: none;' id='g".$game->gameId."'>" ?><td colspan='5'><table width='100%'>
<?php foreach ($game->stats->children() as $statName => $stat): ?>
<tr><td><?php echo $statName; ?></td><td><?php echo formatStat($statName,$stat); ?></td></tr>
<?php endforeach; ?>
<?php echo "</table>" ?>
</td></tr>
<?php endforeach; ?>
</table>

   </center>
</div>
</body>
</html>
